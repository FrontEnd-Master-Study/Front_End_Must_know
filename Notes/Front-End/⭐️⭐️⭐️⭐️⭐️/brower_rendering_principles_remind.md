# 브라우저 랜더링 원리 (복습)

### 홈페이지가 사용자에게 보이는 순서에 대해서 설명해주세요.

<br>

# Anwer

## 브라우저의 의미

> 웹 브라우저는 동기적으로 (HTML + CSS), Javascript 언어를 해석하여 내용을 화면에 보여주는 응용 소프트웨어
>
> ex) 크롬 , 사파리 , 엣지, 파이어 폭스

브라우저는 서로 다른 데이터 해석 방식을 갖고 있을 수 있고 때문에 특정 웹사이트의 외관 또는 기능이 브라우저마다 다르게 표현될 수 있다.

**개발자는 이를 방지하기 위해 [웹 표준](https://seulbinim.github.io/WSA/standards.html#%EC%9B%B9%ED%91%9C%EC%A4%80-%EC%9D%B4%EB%9E%80)을 고려한다**

<br>

### 브라우저 구성요소

- UI
- 브라우저 엔진
- 렌더링 엔진
- 네트워크
- 자바스크립트 번역기
- UI 백엔드
- 데이터 스토리지

_브라우저 마다 상이 할수 있음_

> ex) 크롬 : 브라우저 내부에 브라우저의 UI, 네트워크 스레드, 스토리지 스레드가 같이 들어가 있음.

<img width="500" alt="스크린샷 2022-04-06 오후 7 33 37" src="https://user-images.githubusercontent.com/48541850/161956080-70b95c04-6081-468d-ad44-17e32638f5f0.png">

<br>

#### **UI**(사용자 인터페이스)

> 사용자가 요청한 사이트 외에 '주소창', '뒤로가기/앞으로가기 버튼', '북마크' 등 브라우저와 유저가 상호작용할 수 있는 접점을 말한다.

<img width="1700" alt="스크린샷 2022-04-06 오후 7 27 50" src="https://user-images.githubusercontent.com/48541850/161955164-b5af0b03-27c4-4a58-afe0-7dc3ee46ad25.png">

<br>

#### **Browser Engine**

> UI와 렌더링 엔진 사이의 동작을 조작한다. 유저가 주소창에 무언가 입력하면 브라우저는 이에 대해 쿼리하고 응답을 가져올 수 있도록 렌더링 엔진을 컨트롤한다.
>
> 크롬 같은 경우는 유저가 서핑할 때 브라우저 엔진의 \*UI 스레드와 네트워크 스레드를 통해 컨트롤함.

<br>

#### **Rendering Engine**

> 사용자가 요청한 사이트를 그려주는 역할을 함. 사이트를 구성하고 있는 html, css, xml 등을 파싱하고, 화면에 표시합니다. 렌더링 엔진은 크게 **Webkit**과 모질라에서 만든 **Gecko**가 있음.

_프론트엔드 개발자에게 있어서 중요한 부분_

<br>

#### **NetWorking**

> HTTP 요청과 같은 네트워크 호출에 사용됨. 이것은 플랫폼 독립적인 인터페이스이고 각 플랫폼 하부에서 실행됨.

<br>

#### **UI BackEnd**

> 콤보 박스와 창 같은 기본적인 장치를 그림. 플랫폼에서 명시하지 않은 일반적인 인터페이스로서, OS 사용자 인터페이스 체계를 사용.

<br>

#### **Javascript Interperter**

> 자바스크립트 코드를 해석하고 실행.

<br>

#### **Data Persistence**

> 자료를 저장하는 계층이다. 쿠키를 저장하는 것과 같이 모든 종류의 자원을 하드 디스크에 저장할 필요가 있다. HTML5 명세에는 브라우저가 지원하는 '웹 데이터 베이스'가 정의되어 있다

<br>

#### ❗️추가

크롬은 대부분의 브라우저와 달리 각 탭마다 별도의 렌더링 엔진 인스턴스를 유지하는 것이 주목할만하다. 각 탭은 독립된 프로세스로 처리된다.

---

<br>

### 랜더링 엔진 동작 과정

<div width="1200" height="500" style="display:flex;">
<div width="600"  height="500" style="display:flex; flex-direction:column; margin-right:5px;">
<img width="500" alt="스크린샷 2022-04-06 오후 7 52 50" src="https://user-images.githubusercontent.com/48541850/161959267-59c87a1d-f029-40a2-8e09-3939097e5fbe.png">
<span>웹 킷</span>
</div>

<div width="600" height="500" style="display:flex; flex-direction:column;">
<img width="500" alt="스크린샷 2022-04-06 오후 7 52 40" src="https://user-images.githubusercontent.com/48541850/161959241-abe25a20-19e3-44a3-a247-eb5491d2f662.png">
<span>개코</span>
</div>

</div>

<br>

> 웹킷과 개코가 다른 용어를 쓰지만 기본적으로 동일하다.

1. HTML 마크업을 처리하여 **DOM트리** 생성
2. CSS 마크업을 처리하여 **CSSOM 트리**를 생성한다.
3. DOM 트리와 CSSOM 트리를 결합하여 **렌더링 트리**를 생성한다.
4. 렌더링 트리 배치 : 각 노드에 대해 화면에서의 정확한 위치와 크기를 계산한다.
5. 렌더 트리 그리기 : UI 백엔드에서 렌더링 트리의 각 노드를 가로지르며 렌더링한다.

<br>

좀 더 나은 사용자 경험을 위해 위의 과정을 **점진적으로** 진행한다.

렌더링 엔진은 모든 HTML을 파싱할때까지 기다리지 않고, 배치와 그리기 과정을 시작한다.

네트워크로부터 나머지 내용이 전송되기를 기다리는 동시에 받은 내용의 일부를 먼저 화면에 표시한다

> ❗️ 파서의 오류 수정 : head 등의 태그를 빠뜨려도 파서가 돌면서 오류를 수정해준다.

<br>

<img width="600"  alt="스크린샷" src="https://user-images.githubusercontent.com/48541850/162021551-f9b02193-9337-4af0-bb62-41878f7cf7af.jpeg">

<br>

## 요약

### 브라우저의 동작 과정

```
1. 사용자가 url을 입력하고 Enter를 누르면, 서버에 요청이 전송됨

2. 해당 페이지에 존재하는 여러 자원들이 보내짐

3. 브라우저는 해당 자원이 담긴 html과 스타일이 담긴 css를 W3C 명세에 따라 해석할 것

4. html파서가 문서에 존재하는 어휘와 구문을 분석하며 DOM트리 구축

5. css파서가 모든 css 정보를 스타일 구조체로 생성(CSSOM)

6. DOM + CSSOM = 렌더 트리 생성

7. 각 노드에 대해 화면에서의 정확한 위치와 크기 계산

8. UI백엔드가 렌더링 트리의 각 노드 가로 지르며 렌더링
```

_7,8번의 과정은 점진적으로 진행됨_

<br>

---

<br>

### 추가 내용

**파싱** : 도큐먼트를 코드가 이해하고 사용할 수 있는 구조로 변환하는 과정

> 파싱된 결과물은 도큐먼트의 구조를 나타내는 트리 형태 이를 DOM tree 라고 함.

<img width="300" alt="스크린샷 2022-04-07 오전 1 43 32" src="https://user-images.githubusercontent.com/48541850/162025426-e267a82c-e00f-4298-91e2-9f1aea64d47a.png">

## 참고

- [Never D2 브라우저는 어떻게 동작하는가](https://d2.naver.com/helloworld/59361)
- [브라우저 동작 과정에 대해 알아보자](https://kim6394.tistory.com/217)
